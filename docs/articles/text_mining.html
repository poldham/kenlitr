<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text Mining • kenlitr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Text Mining">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kenlitr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/creating_kenlit.html">Creating Kenlit</a>
    </li>
    <li>
      <a href="../articles/text_mining.html">Text Mining</a>
    </li>
    <li>
      <a href="../articles/workshop.html">Nairobi Workshop</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/poldham/kenlitr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Text Mining</h1>
                        <h4 class="author">Paul Oldham</h4>
            
            <h4 class="date">30/07/2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/poldham/kenlitr/blob/master/vignettes/text_mining.Rmd"><code>vignettes/text_mining.Rmd</code></a></small>
      <div class="hidden name"><code>text_mining.Rmd</code></div>

    </div>

    
    
<!--- add in fields of study to the text_mine function--->
<!--- make sure texts are available for text mining--->
<p>Text mining involves extracting useful information from text fields. Text mining is increasingly tied in with machine learning approaches using tools such as spaCy. In this session we will demonstrate some basic approaches to text mining using the <code>tidytext</code> package with R. If you want to learn more about text mining in R <a href="https://www.tidytextmining.com/">Text Mining with R</a> by <a href="https://juliasilge.com/">Julia Silge</a> and <a href="http://varianceexplained.org/about/">David Robinson</a> is strongly recommended. For Python fans it doesn’t get much better than <a href="https://spacy.io/">SpaCy</a> by <a href="https://twitter.com/honnibal">Matthew Honnibal</a> and <a href="https://twitter.com/_inesmontani">Ines Montani</a> at Explosion AI. You may also want to try <a href="https://quanteda.io/">quanteda</a> and <a href="https://spacyr.quanteda.io/articles/using_spacyr.html">spacyr</a> from Ken Benoit and Kohei Watanabe at the LSE.</p>
<p>The Kenlit package contains the following resources for text mining and a basic function <code><a href="../reference/text_mine.html">text_mine()</a></code> to help you get started.</p>
<p>The main fields available for text mining in Kenlit are</p>
<ol style="list-style-type: decimal">
<li>Keywords</li>
<li>Fields of Study (fos)</li>
<li>Titles</li>
<li>Abstracts</li>
<li>MeSH Terms (Medical Subject Headings)</li>
</ol>
<p>You will find examples using these fields in the documentation for the <code><a href="../reference/text_mine.html">text_mine()</a></code> function. Under the hood the <code><a href="../reference/text_mine.html">text_mine()</a></code> function is powered by the <code>tidytext</code> package. The <code><a href="../reference/texts.html">kenlitr::texts</a></code> dataset combines the title and abstract fields into one data set for text mining and machine learning.</p>
<p>Let’s take a look at the keywords first.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb1-3" title="3">kenlitr<span class="op">::</span>lens <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(keywords) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/tidyr/topics/drop_na">drop_na</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 1
##   keywords                                                                 
##   &lt;chr&gt;                                                                    
## 1 Education; Government Sponsored Programs; Kenya; Organization And Admini…
## 2 Adolescents; Adolescents, Female; Africa; Africa South Of The Sahara; Ag…
## 3 TICKS; TISSUE CULTURE                                                    
## 4 CATTLE; EXPERIMENTAL LAB STUDY; KIDNEY; RINDERPEST; VERTEBRATE VIRUSES; …
## 5 Africa; Africa South Of The Sahara; Americas; Asia; Brazil; Case Studies…
## 6 CATTLE/diseases; DISTOMIASIS/veterinary; ECHINOCOCCOSIS/veterinary</code></pre>
<p>We can see that many records have keywords that are grouped together with “;” as the separator. We can also see that athre are mixed cases. What we want to do is</p>
<ol style="list-style-type: decimal">
<li>Separate out the keywords and phrases onto their own row</li>
<li>Regularise the case to lower so that they will count up correctly (Education and education will match)</li>
</ol>
<p>The <code>text_mine</code> function will do that for us.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">kenlitr<span class="op">::</span>lens <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" title="2">kenlitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/kenlitr/topics/text_mine">text_mine</a></span>(., <span class="dt">col =</span> <span class="st">"keywords"</span>, <span class="dt">top =</span> <span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">20</span>)</a></code></pre></div>
<pre><code>## Selecting by n</code></pre>
<pre><code>## # A tibble: 20 x 2
##    terms                          n
##    &lt;chr&gt;                      &lt;int&gt;
##  1 kenya                       1701
##  2 africa                      1219
##  3 developing countries         891
##  4 africa south of the sahara   704
##  5 eastern africa               657
##  6 english speaking africa      643
##  7 hiv                          488
##  8 population                   473
##  9 demographic factors          456
## 10 malaria                      451
## 11 research methodology         402
## 12 diseases                     400
## 13 health                       309
## 14 population dynamics          289
## 15 population characteristics   277
## 16 sub-saharan africa           277
## 17 family planning              276
## 18 research report              248
## 19 economic factors             237
## 20 studies                      237</code></pre>
<p>We now have a much clearer idea of the keywords used by authors. We can use this data to do things such as refining our search. We can see that health topics such as the HIV and malaria along with demographic factors are prominent in the results. Possibly the specialisit Medical Subject Headings (MeSH) terms will give us a clearer idea.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">kenlitr<span class="op">::</span>lens <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-2" title="2">kenlitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/kenlitr/topics/text_mine">text_mine</a></span>(., <span class="dt">col =</span> <span class="st">"mesh_terms"</span>, <span class="dt">top =</span> <span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">20</span>)</a></code></pre></div>
<pre><code>## Selecting by n</code></pre>
<pre><code>## # A tibble: 20 x 2
##    terms                       n
##    &lt;chr&gt;                   &lt;int&gt;
##  1 humans                  22827
##  2 female                  14774
##  3 male                    11986
##  4 kenya                    9677
##  5 animals                  9292
##  6 adult                    8734
##  7 adolescent               5907
##  8 middle aged              5332
##  9 child                    4665
## 10 child, preschool         3827
## 11 kenya/epidemiology       3792
## 12 young adult              3607
## 13 infant                   3569
## 14 cross-sectional studies  2661
## 15 aged                     2477
## 16 prevalence               2356
## 17 pregnancy                2335
## 18 risk factors             2067
## 19 infant, newborn          1914
## 20 developing countries     1705</code></pre>
<p>The top terms are not wildly informative except that we learn that in the health field there is a stronger focus on females than males. Adolescents are also prominent along with children and preschool children.</p>
<p>We could use one or more of these terms to filter the dataset. One way to do this is to identify all of the records containing the term Female or female in the mesh_terms and then filtering the dataset down to only those records. Here we just show the titles.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(stringr)</a>
<a class="sourceLine" id="cb9-3" title="3">kenlitr<span class="op">::</span>lens <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">female_health =</span> <span class="kw"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span>(mesh_terms, <span class="st">"Female|female"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(female_health <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(title) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">20</span>)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 1
##    title                                                                   
##    &lt;chr&gt;                                                                   
##  1 Recent smallbox epidemics in Ethiopia and Somalia, human monkey pox vir…
##  2 Trypanosoma congolense: III. Serological responses of experimentally in…
##  3 Analysis of a series of laparoscopic procedures performed in Nairobi.   
##  4 A zoonotic focus of cutaneous leishmaniasis due to Leishmania tropica a…
##  5 The Immunity Induced in Cattle and Sheep by Inoculation of Neurotropic …
##  6 Two simple antigen-detection enzyme immunoassays for the diagnosis of T…
##  7 Menarche in African girls in some post-secondary institutions in Kenya  
##  8 The pattern of chronic gastric ulcer at Kenyatta National Hospital (K.N…
##  9 Comparison of mosquito nets, proguanil hydrochloride, and placebo to pr…
## 10 Intergroup Encounters among Free-Ranging Vervet Monkeys                 
## 11 Infection and Disease After Perinatal Exposure to Chlamydia trachomatis…
## 12 Résidus d'antibiotiques dans le lait, après application intramammaire, …
## 13 Mental health problems in Kenya today--a review of research.            
## 14 Phlebotomus (Phlebotomus) duboscqi from Kenya: A new record             
## 15 Development of Leishmania major in Phlebotomus duboscqi and Sergentomyi…
## 16 Modification of Sand Fly Biting Behavior by Leishmania Leads to Increas…
## 17 Separation and individuation in an African society: the developmental t…
## 18 A Comparative Study of Users of Long-Term Contraceptive Subdermal Impla…
## 19 Epidemic kerato-conjunctivitis.                                         
## 20 Effect of mass chemotherapy and piped water on numbers of Schistosoma h…</code></pre>
<p>A quick review of the titles tells us that the term female is being used both to refer to humans and to animals. So, we would probably want to filter again. We won’t go there now but we can see how we can start to use the results of keyword analysis to refine the data to subjects of interest and drill down into the data.</p>
<div id="title-and-abstract-fields" class="section level3">
<h3 class="hasAnchor">
<a href="#title-and-abstract-fields" class="anchor"></a>Title and Abstract Fields</h3>
<p>The main body of texts that are normally available to us are found in the titles and abstracts. The <code><a href="../reference/texts.html">kenlitr::texts</a></code> table extracts these fields from the <code>lens</code> table to make them easier to text mine. Note that because of their size (276,998 rows) this can take some time to do. We will focus here on the titles as the quickest to return results. We will also visualize these results by setting <code>viz = TRUE</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">kenlitr<span class="op">::</span>lens <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" title="2">kenlitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/kenlitr/topics/text_mine">text_mine</a></span>(., <span class="dt">col =</span> <span class="st">"title"</span>, <span class="dt">top =</span> <span class="dv">20</span>, <span class="dt">token =</span> <span class="st">"words"</span>, <span class="dt">title =</span> <span class="st">"Top Terms in Title"</span>, <span class="dt">x_label =</span> <span class="st">"Terms"</span>, <span class="dt">y_label =</span> <span class="st">"Publication Count"</span>, <span class="dt">viz =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Selecting by n</code></pre>
<p><img src="text_mining_files/figure-html/titles-1.png" width="700"></p>
<p>Individual works like this on their own are not hugely informative. Note that the use of the stacked bar chart for exploratory analysis gives us an idea but the term kenya is so dominant it is hard to gain a sense of proportion. We would want I think to exclude Kenya for a clearer view here. We do however see that management and development appear promimently along with health, HIV and references to counties and districts which hints at geographic information in this data.</p>
<p>We can try to improve the information content by parsing this data into multi-word phrases (ngrams). In general, from past experience, two word phrases are the most informative.</p>
<p>Here we will use the combined titles and abstracts. Note that this can take some time to run.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">kenlitr<span class="op">::</span>texts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" title="2">kenlitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/kenlitr/topics/text_mine">text_mine</a></span>(., <span class="dt">col =</span> <span class="st">"text"</span>, <span class="dt">top =</span> <span class="dv">20</span>, <span class="dt">token =</span> <span class="st">"ngrams"</span>, <span class="dt">n_gram =</span> <span class="dv">2</span>, <span class="dt">title =</span> <span class="st">"Top Ngrams in Titles &amp; Abstracts"</span>, <span class="dt">x_label =</span> <span class="st">"Terms"</span>, <span class="dt">y_label =</span> <span class="st">"Publication Count"</span>, <span class="dt">viz =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Selecting by n</code></pre>
<p><img src="text_mining_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>This data reveals that we have some apparent noise that we would like to filter out such as “95 ci” and “de la” (“of the” in Spanish).</p>
</div>
<div id="show-network" class="section level3">
<h3 class="hasAnchor">
<a href="#show-network" class="anchor"></a>Show Network</h3>
</div>
<div id="create-sentences" class="section level3">
<h3 class="hasAnchor">
<a href="#create-sentences" class="anchor"></a>Create Sentences</h3>
<p>We take the texts data and convert into sentences (to pass to spaCy). What we want to know is which sentences contain a reference to a place. We will add a sentence id column that we will join with the doc_id column to make matching the precise sentence containing a term easier later on (otherwise we will identify documents not sentences). The separator when uniting the doc_id and sentence ids is automatically and underscore using <code><a href="https://www.rdocumentation.org/packages/tidyr/topics/unite">tidyr::unite()</a></code>. The original doc_id field will disappear. At a later stage we will use dplyr::separate to get back to the original document id</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidytext)</a>
<a class="sourceLine" id="cb15-2" title="2">sentences &lt;-<span class="st"> </span>kenlitr<span class="op">::</span>texts <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/tidytext/topics/unnest_tokens">unnest_tokens</a></span>(text, text, <span class="dt">token =</span> <span class="st">"sentences"</span>, <span class="dt">to_lower =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="st">  </span><span class="kw">add_column</span>(<span class="dt">sent_id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(.)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/tidyr/topics/unite">unite</a></span>(doc_id, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"doc_id"</span>, <span class="st">"sent_id"</span>))</a></code></pre></div>
<p>We will use the python library spaCy in the R package <code>spacyr</code> to extract nounphrases from the kenya_places data.frame.</p>
<p>To install spacyr on your system follow the instructions at <a href="https://github.com/quanteda/spacyr">https://github.com/quanteda/spacyr</a>. It can be a little bit involved but is worth it.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(spacyr)</a>
<a class="sourceLine" id="cb16-2" title="2">spacyr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/spacyr/topics/spacy_initialize">spacy_initialize</a></span>(<span class="dt">model =</span> <span class="st">"en_core_web_sm"</span>)</a>
<a class="sourceLine" id="cb16-3" title="3"></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="co"># spacyr expects TIF compliant data frame consisting of doc_id and text column</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="co"># use select to selct and rename</span></a>
<a class="sourceLine" id="cb16-6" title="6">kenya_match &lt;-<span class="st"> </span>kenlitr<span class="op">::</span>kenya_places <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="dt">doc_id =</span> geonameid, <span class="dt">text =</span> asciiname)</a>
<a class="sourceLine" id="cb16-8" title="8"></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="co"># extract nounphrases</span></a>
<a class="sourceLine" id="cb16-10" title="10">kenya_match &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/spacyr/topics/spacy_extract_nounphrases">spacy_extract_nounphrases</a></span>(kenya_match, <span class="dt">output =</span> <span class="st">"data.frame"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">geonameid =</span> doc_id)</a></code></pre></div>
<p>This identified 28,591 root terms from the original data frame containing 29,598 rows.</p>
<p>Let’s take a look at the top ranking names. We will also do some tidying up to remove the term Kenya (as it defines the dataset) and terms that are two characters or less as these will commmonly generate noise.</p>
<!---Note that we could lose mount kenya this way but Mount will show up as the root phrase elsewhere, left as is--->
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">places_root &lt;-<span class="st"> </span>kenya_match <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tally.html">count</a></span>(root_text, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">nchar =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nchar">nchar</a></span>(root_text)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-4" title="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(nchar <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">root_text =</span> <span class="kw"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span>(root_text, <span class="dt">side =</span> <span class="st">"both"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(root_text <span class="op">!=</span><span class="st"> "Kenya"</span>) </a>
<a class="sourceLine" id="cb17-7" title="7">  </a>
<a class="sourceLine" id="cb17-8" title="8">places_root</a></code></pre></div>
<p>If we try and match 16000 terms against 1 million sentences in some kind of loop in R it will take a very long time. An alternative way forward is to compare the noun phrases we just created against a word list. That way we will know which sentences contain a candidate place names. Because we want to identify place names that are proper names we will change the default to_lower from TRUE to FALSE. We do not need to specify the tokens argument because the default is <code>words</code>. We then create a new column called <code>places_root</code> to mark up the matches before filtering to only those that match.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">sentences_words &lt;-<span class="st"> </span>sentences <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/tidytext/topics/unnest_tokens">unnest_tokens</a></span>(text, text, <span class="dt">to_lower =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># maintain uppper case</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">places_root =</span> .<span class="op">$</span>text <span class="op">%in%</span><span class="st"> </span>places_root<span class="op">$</span>root_text) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># compare using %in%</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(places_root <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="co"># filter to TRUE matches</span></a></code></pre></div>
<p>We have now reduced out 1.1 million sentences to 452,066 references to 149,138 of our places roots for further analysis (based on <code>sentences_words %&gt;% count(doc_id)</code>). We now know two important things that we didn’t know before:</p>
<ol style="list-style-type: decimal">
<li>We know that 149,138 sentences contain root terms that are candidates for place names.</li>
<li>We know that the remaining sentences are FALSE in terms of these root terms.</li>
</ol>
<p>For moving to machine learning approaches this means we have the basis for TRUE/FALSE labelled datasets for training and evaluation.</p>
<p>However, when we take a look at the root terms we can see that terms such as Army or World that appear in place names in Kenya are not necessarily going to result in valid places (e.g. Kenya’s Army, Kenyan Army etc.).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">sentences_words</a></code></pre></div>
<p>At this juncture lets mark up the sentences table as TRUE or FALSE. Here we use the doc_id in each table as the basis for the match (many docs contain more than one of our places root terms and so we want to reduce them to individual sentences).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">sentences &lt;-<span class="st"> </span>sentences <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-2" title="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">places_root =</span> .<span class="op">$</span>doc_id <span class="op">%in%</span><span class="st"> </span>sentences_words<span class="op">$</span>doc_id)</a>
<a class="sourceLine" id="cb20-3" title="3">sentences</a></code></pre></div>
<p>We can see in the print out of the top ten rows that the last result (which matched on Kakamega and separately matched on Forest) refers to a valid place. However, there will be other sentences where the match is a false positive.</p>
<!--- In the rwanda match case this may need to be rerun with word boundaries--->
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">sentences_true &lt;-<span class="st"> </span>sentences <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(places_root <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb21-3" title="3"></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="co"># create a false label set with the same number of rows as the true set for use in training and evaluation</span></a>
<a class="sourceLine" id="cb21-5" title="5">sentences_false &lt;-<span class="st"> </span>sentences <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-6" title="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(places_root <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-7" title="7"><span class="st">  </span>.[<span class="dv">1</span><span class="op">:</span><span class="dv">259969</span>,]</a></code></pre></div>
<p>Inspect the true version</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">sentences_true</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># write the two sets of sentences to json as a single labelled object to read in to Spacy for model building.</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="co"># spacy (prodigy) is expecting data labelled under "answer": "accept" or "reject" in json format (see below) so let's adjust the column names</span></a>
<a class="sourceLine" id="cb23-3" title="3">kenya_spacy &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(sentences_true, sentences_false) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">answer =</span> places_root) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">answer =</span> <span class="kw"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span>(answer, <span class="st">"TRUE"</span>, <span class="st">"accept"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-6" title="6"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">answer =</span> <span class="kw"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span>(answer, <span class="st">"FALSE"</span>, <span class="st">"reject"</span>))</a>
<a class="sourceLine" id="cb23-7" title="7"></a>
<a class="sourceLine" id="cb23-8" title="8"><span class="co"># save to R for reference</span></a>
<a class="sourceLine" id="cb23-9" title="9"><span class="co">#save(kenya_spacy, file = "kenya_spacy.rda", compress = "xz")</span></a>
<a class="sourceLine" id="cb23-10" title="10"></a>
<a class="sourceLine" id="cb23-11" title="11"><span class="co"># write to json lines (jsonl) as spacy preferred format and cross check</span></a>
<a class="sourceLine" id="cb23-12" title="12">jsonlite<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/jsonlite/topics/stream_in">stream_out</a></span>(kenya_spacy, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">file</a></span>(<span class="st">"kenya_spacy.jsonl"</span>))</a></code></pre></div>
<p>We are now in a position to import the data into spaCy to update the machine learning model with Kenya specific data.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Paul Oldham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
