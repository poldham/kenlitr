<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating Kenlit â€¢ kenlitr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Creating Kenlit">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kenlitr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/creating_kenlit.html">Creating Kenlit</a>
    </li>
    <li>
      <a href="../articles/workshop.html">Nairobi Workshop</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/poldham/kenlitr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Creating Kenlit</h1>
                        <h4 class="author">Paul Oldham</h4>
            
            <h4 class="date">29/07/2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/poldham/kenlitr/blob/master/vignettes/creating_kenlit.Rmd"><code>vignettes/creating_kenlit.Rmd</code></a></small>
      <div class="hidden name"><code>creating_kenlit.Rmd</code></div>

    </div>

    
    
<p>Kenlit is a dataset of open access data for scientific publications from or about Kenya.</p>
<p>Kenlit was created using two sources:</p>
<ol style="list-style-type: decimal">
<li>Microsoft Academic Graph, for publications from organisations in Kenya</li>
<li>The Lens <a href="https://www.lens.org/">https://www.lens.org/</a> database of scientific and patent literature, for any scientific literature mentioning Kenya.</li>
</ol>
<p>The idea behind Kenlit is to capture the universe of scientific publications from or mentioning Kenya. It is deliberately rough and ready to allow for refinement and for use in data science workshops.</p>
<div id="the-lens" class="section level3">
<h3 class="hasAnchor">
<a href="#the-lens" class="anchor"></a>The Lens</h3>
<p>The Lens provides access to data from over 190 million scientific publications. To create the general data for Kenya (see lens.csv or lens.rda) a simple search for the word Kenya was carried out across all fields in the Lens. At the time when Kenlit was created this led to 176,335 results. This had increased to 191,952 as of the end of July 2019. We can see the search results from July 29th 2019 below.</p>
<p><img src="../../vignettes/images/kenya_lens.png"><!-- --></p>
<p>The Lens includes data from a range of different sources inclucing Microsoft Academic Graph, Crossref, PubMed, Core and PubMed Central. We can clearly see above that the dominant data source is Microsoft Academic Graph.</p>
<p>This search of the Lens is <em>noisy</em> because it will capture irrelevant results.</p>
<ol style="list-style-type: decimal">
<li>It includes searches of the organisation and author fields. This means that the data will need to be cleaned for example to exclude authors with the surname Kenya.</li>
<li>It includes searches of the full texts of publications from the Core database <a href="https://core.ac.uk/">https://core.ac.uk/</a> of open access full text publications. This improves data capture for Kenya but it will also capture passing references to Kenya where the only reference to Kenya is in the bibliography.</li>
</ol>
<p>For the purpose of creating Kenlit this is fine as the aim is to capture the universe of things that come from or refer to Kenya. However, in later analysis it will be important to clean this data, for example by filtering out the name Kenya in author fields.</p>
<p>Data from the Lens presently has the important limitation that the author affiliation data (Institutions) are not avaialble for download with the other data. However, investigation of the affiliation data reveals additional issues as can be seen in the image below.</p>
<p><img src="../../vignettes/images/kenya_institutions.png"><!-- --></p>
<p>In considering this image note that the affiliation data, which comes from Microsoft Academic Graph, is limited in its coverarge producing the problem of missing data. Also note that in the Lens and in Kenlit, the affiliation data is limited to those organisations that appear in the Global Research Identifier Database (GRID). GRID addresses the problem of variations in the name of institutions but presently covers 99,000 organisations worldwide and is a work in progress.</p>
<p>So for affiliation data we have two sources of missingness:</p>
<ol style="list-style-type: decimal">
<li>Records where affiliation data is missing from the record</li>
<li>Records where affiliation data is present but is not included in the GRID database at the moment.</li>
</ol>
<p>To create the Lens data in Kenlit the strategy used was to create a set of date limited collections with upto 50,000 records (a free account is required to create collections). These were downloaded and combined together into one table (lens.rda in the package and lens.csv in the zip archive).</p>
<p>Following the creation of Kenlit, the Lens released a free public Scholarly API <a href="https://www.lens.org/lens/user/subscriptions">https://www.lens.org/lens/user/subscriptions</a>. In future work the API will be used to update and refine Kenlit.</p>
</div>
<div id="microsoft-academic-graph" class="section level3">
<h3 class="hasAnchor">
<a href="#microsoft-academic-graph" class="anchor"></a>Microsoft Academic Graph</h3>
<p><a href="https://www.microsoft.com/en-us/research/project/microsoft-academic-graph/">Microsoft Academic Graph</a>) is a graph of scientific publications indexed by the Bing search engine that can be accessed through <a href="https://academic.microsoft.com/home">Microsoft Academic</a>, through an API <a href="https://docs.microsoft.com/en-us/azure/cognitive-services/academic-knowledge/home">https://docs.microsoft.com/en-us/azure/cognitive-services/academic-knowledge/home</a> or as a set of relational database tables available on request from Microsoft Academic in an <a href="https://docs.microsoft.com/en-us/academic-services/graph/samples-azure-data-lake-analytics">Azure Storage Blob</a>.</p>
<p>The data tables contain over 100 million records and are most suitable to users comfortable with using data at scale and with SQL.Microsoft provides guidance of set up with Azure Data Lake Analytics, but as we did not expect to use MAG all the time we took a different approach. This involved creating a Databricks Apache Spark cluster on Azure (which is easy to set up) and importing the tables onto the cluster. To work with the tables we used the option to add RStudio on the master node of the cluster and then created table joins using <code>sparklyr</code> in R before exporting the data.</p>
<p>MAG provides a straightforward data schema whereby different tables are linked using the <code>paperid</code> field as the primary key (Microsoft Academic in the Lens). The paperid field along with the affiliationid, authorid and fieldsofstudyid allow for table joins to be performed. The <a href="https://docs.microsoft.com/en-us/academic-services/graph/reference-data-schema">schema</a> for joins is displayed below.</p>
<p><img src="../../vignettes/images/entity-relationship-diagram.png"><!-- --></p>
<p>The focus in using MAG on the cluster was identifying publications originating from Kenyan research organisations.</p>
<p>To do this two initial steps were taken</p>
<ol style="list-style-type: decimal">
<li>The Affiliations table from MAG (january 2019) was imported into R</li>
<li>The February 2019 release of the GRID database was imported into R</li>
<li>The two tables were joined to create an <code>affiliations_grid</code> table</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># import the MAG affiliations table</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(readr)</a>
<a class="sourceLine" id="cb1-3" title="3">affiliations &lt;-<span class="st"> </span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim</a></span>(<span class="st">"Affiliations.txt"</span>, <span class="dt">col_names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"affiliationid"</span>, <span class="st">"rankno"</span>,</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="st">"normalizedname"</span>, </a>
<a class="sourceLine" id="cb1-5" title="5"><span class="st">"displayname"</span>, </a>
<a class="sourceLine" id="cb1-6" title="6"><span class="st">"grid_id"</span>,</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="st">"officialpage"</span>,</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="st">"wikipage"</span>,</a>
<a class="sourceLine" id="cb1-9" title="9"><span class="st">"papercount"</span>,</a>
<a class="sourceLine" id="cb1-10" title="10"><span class="st">"citationcount"</span>, </a>
<a class="sourceLine" id="cb1-11" title="11"><span class="st">"createddate"</span>),                                                             </a>
<a class="sourceLine" id="cb1-12" title="12"><span class="dt">delim =</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>, <span class="dt">escape_double =</span> <span class="ot">FALSE</span>, <span class="dt">trim_ws =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="co"># import GRID name and address table</span></a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16">grid_name_address &lt;-<span class="st"> </span><span class="kw"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span>(<span class="st">"~/grid/grid_name_address.csv"</span>)</a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co"># join the tables retaining all he data in affiliations and </span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co"># adding the GRID data where available</span></a>
<a class="sourceLine" id="cb1-20" title="20">affiliations_grid &lt;-<span class="st"> </span><span class="kw">left_join</span>(affiliations, grid_name_address, <span class="dt">by =</span> <span class="st">"grid_id"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-21" title="21"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>email_address, <span class="op">-</span>line_<span class="dv">1</span>, <span class="op">-</span>line_<span class="dv">2</span>, <span class="op">-</span><span class="st"> </span>line_<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb1-22" title="22"></a>
<a class="sourceLine" id="cb1-23" title="23"><span class="co"># save to disk</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="kw"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span>(affiliations_grid, <span class="st">"affiliations_grid.csv"</span>)</a></code></pre></div>
<p>On the cluster the next step was to create the table joins to retrieve the publications linked to the affiliations using the <code>affiliationid</code> column,</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sparklyr)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co"># on the cluster</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># filter the data to Kenya </span></a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7">kenya &lt;-<span class="st"> </span>affiliations_grid <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(country_code <span class="op">==</span><span class="st"> "KE"</span>)</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co"># join to the affiliation paperss and paper tables retaining only shared data (using inner join)</span></a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11">kenya_affiliations_papers &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(kenya, affiliations_papers, <span class="dt">by =</span> <span class="st">"affiliationid"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(., papers, <span class="dt">by =</span> <span class="st">"paperid"</span>)</a></code></pre></div>
<p>We then follow the same procedure for the fields of study and the authors</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># join the authors to to affiliation data</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3">kenya_papers_authors &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(kenya_affiliations_papers, authors, <span class="dt">by =</span> <span class="st">"authorid"</span>)</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co"># join the fields of study table</span></a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7">kenya_fosid &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(kenya_affiliations_papers_unique, fos_papers, <span class="dt">by =</span> <span class="st">"paperid"</span>)</a></code></pre></div>
<p>The files are then written to the Dababricks cluster file system (DBFS) in parquet format, downloaded using the Databricks Client in the terminal and imported to write to a csv file.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># on the clusterwrite to the Data Bricks file system</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/sparklyr/topics/spark_write_table">spark_write_table</a></span>(kenya_papers_authors, <span class="st">"kenya_papers_authors_spark_tbl"</span>)</a></code></pre></div>
<p>Read the files back into R locally</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sparklyr)</a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co"># read in the parquet files</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/sparklyr/topics/spark_read_parquet">spark_read_parquet</a></span>(sc, <span class="st">"kenya_papers_authors"</span>, <span class="st">"kenya_papers_authors_spark_tbl"</span>)</a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co"># create a table</span></a>
<a class="sourceLine" id="cb5-7" title="7">kenya_authors_tbl &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/tbl.html">tbl</a></span>(sc, <span class="st">"kenya_papers_authors"</span>)</a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9"></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co"># collect into an object in the local environment (not as a Spark table)</span></a>
<a class="sourceLine" id="cb5-11" title="11">kenya_authors &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sparklyr/topics/collect">collect</a></span>(kenya_authors_tbl)</a>
<a class="sourceLine" id="cb5-12" title="12"></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co"># write to file as normal</span></a>
<a class="sourceLine" id="cb5-14" title="14"></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="kw"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span>(kenya_authors, <span class="st">"kenya_authors.csv"</span>)</a></code></pre></div>
<p>In kenlit, the filenames are simplified to authors, affiliations, papers and fos.</p>
</div>
<div id="adding-data-to-the-lens-dataset" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-data-to-the-lens-dataset" class="anchor"></a>Adding Data to the Lens dataset</h3>
<p>As noted above the data from the Lens did not include the affiliation data. However, affiliation data can be retrieved directly from MAG using the microsoft academic id from the Lens which is the MAG paperid as the key.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Paul Oldham.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
